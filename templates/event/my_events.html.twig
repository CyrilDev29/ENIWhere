{% extends 'base.html.twig' %}

{% block title %}
    {% if is_granted('ROLE_ADMIN') %}
        Tous les événements
    {% else %}
        Mes événements
    {% endif %}
{% endblock %}


{% block stylesheets %}
    <style>
        /* Animation hover sur les cartes d’événements */
        .event-card {
            border-radius: 16px;
            box-shadow: 0 12px 28px rgba(0,0,0,.08);
            transition: transform .28s ease, box-shadow .28s ease;
        }
        .event-card:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 22px 45px rgba(0,0,0,.18);
        }
    </style>
{% endblock %}


{% block body %}
    <div class="container mt-4">

        {# ====== Titre ====== #}
        <h1 class="mb-4 text-center text-primary fw-bold">
            {% if is_granted('ROLE_ADMIN') %}
                Tous les événements
            {% else %}
                Mes événements
            {% endif %}
        </h1>

        {# ====== Flash messages ====== #}
        {% for label, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ label == 'success' ? 'success' : 'danger' }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fermer"></button>
                </div>
            {% endfor %}
        {% endfor %}

        {# ====== Liste des événements ====== #}
        {% if events is empty %}
            <div class="alert alert-info text-center shadow-sm rounded">
                {% if is_granted('ROLE_ADMIN') %}
                    Aucun événement disponible.
                {% else %}
                    Vous n'avez aucun événement en tant qu'organisateur.
                {% endif %}
            </div>
        {% else %}
            <div class="row g-4">
                {% for e in events %}
                    <div class="col-md-6 col-lg-4">
                        <div class="card event-card h-100">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title text-primary fw-bold">{{ e.name }}</h5>

                                <p class="card-text mb-1">
                                    <strong>Date/heure :</strong>
                                    {{ e.startDateTime ? e.startDateTime|date('d/m/Y H:i') : '-' }}
                                </p>
                                <p class="card-text mb-1"><strong>Site :</strong> {{ e.site ? e.site.name : '-' }}</p>
                                <p class="card-text mb-1"><strong>Lieu :</strong> {{ e.place ? e.place.name : '-' }}</p>

                                {% if is_granted('ROLE_ADMIN') %}
                                    <p class="card-text mb-1">
                                        <strong>Organisateur :</strong>
                                        {{ e.organizer ? e.organizer.username : '-' }}
                                    </p>
                                {% endif %}

                                <p class="card-text mb-1">
                                    <strong>État :</strong>
                                    {% set etat = e.state %}
                                    {% if etat == 'Ouvert' %}
                                        <span class="badge rounded-pill bg-success-subtle text-success">Ouvert</span>
                                    {% elseif etat == 'Clôturé' %}
                                        <span class="badge rounded-pill bg-danger-subtle text-danger">Clôturé</span>
                                    {% else %}
                                        <span class="badge rounded-pill bg-secondary-subtle text-secondary">{{ etat }}</span>
                                    {% endif %}
                                </p>

                                <p class="card-text mb-3">
                                    <strong>Inscrits :</strong>
                                    {{ e.registrations|length }}/{{ e.maxParticipant ?? '-' }}
                                </p>

                                <div class="mt-auto">
                                    <a href="{{ path('event_manage', {id: e.id}) }}" class="btn btn-primary w-100">
                                        <i class="bi bi-pencil-square me-1"></i> Gérer
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endblock %}

